package ru.lanit.ws.security;

import java.io.*;
import java.util.List;
import java.util.zip.ZipEntry;
import java.util.zip.ZipInputStream;

import org.apache.commons.codec.binary.Base64;
import org.junit.Assert;
import org.junit.Ignore;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.oxm.Unmarshaller;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

import ru.lanit.ws.pgu.ApplicationHelper;

@ContextConfiguration(locations = { "classpath:test-context.xml" })
@RunWith(SpringJUnit4ClassRunner.class)
public class ApplicationHelperTest {

	@Autowired
	@Qualifier("applicationMarshaller")
	private Unmarshaller unmarshaller;

	@Test
	@Ignore
	public void testApplicationHelper() throws Exception {
		String encoded = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjx4czpzY2hlbWEgeG1sbnM6eHM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hIiB4bWxuczpzbWV2PSJodHRwOi8vc21ldi5nb3N1c2x1Z2kucnUvcmV2MTExMTExIiB4bWxuczp4b3A9Imh0dHA6Ly93d3cudzMub3JnLzIwMDQvMDgveG9wL2luY2x1ZGUiIHRhcmdldE5hbWVzcGFjZT0iaHR0cDovL3NtZXYuZ29zdXNsdWdpLnJ1L3JldjExMTExMSIgZWxlbWVudEZvcm1EZWZhdWx0PSJxdWFsaWZpZWQiIGF0dHJpYnV0ZUZvcm1EZWZhdWx0PSJ1bnF1YWxpZmllZCIgdmVyc2lvbj0iMS4wIj4NCgk8eHM6aW1wb3J0IG5hbWVzcGFjZT0iaHR0cDovL3d3dy53My5vcmcvMjAwNC8wOC94b3AvaW5jbHVkZSIgc2NoZW1hTG9jYXRpb249Imh0dHA6Ly93d3cudzMub3JnLzIwMDQvMDgveG9wL2luY2x1ZGUiLz4NCg0KDQoJPHhzOmVsZW1lbnQgbmFtZT0iU2VuZGVyIiB0eXBlPSJzbWV2Om9yZ0V4dGVybmFsVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JTQsNC90L3Ri9C1INC+INGB0LjRgdGC0LXQvNC1LdC40YbQuNCw0YLQvtGA0LUg0LLQt9Cw0LjQvNC+0LTQtdC50YHRgtCy0LjRjw0KCQkJCSjQn9C+0YLRgNC10LHQuNGC0LXQu9C1KSAo0LLQsNC70LjQtNC40YDRg9C10YLRgdGPINCh0JzQrdCSINC90LAg0YHQvtC+0YLQstC10YLRgdGC0LLQuNC1INGB0LXRgNGC0LjRhNC40LrQsNGC0YMpDQoJCQk8L3hzOmRvY3VtZW50YXRpb24+DQoJCTwveHM6YW5ub3RhdGlvbj4NCgk8L3hzOmVsZW1lbnQ+DQoJPHhzOmVsZW1lbnQgbmFtZT0iUmVjaXBpZW50IiB0eXBlPSJzbWV2Om9yZ0V4dGVybmFsVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JTQsNC90L3Ri9C1INC+INGB0LjRgdGC0LXQvNC1LdC/0L7Qu9GD0YfQsNGC0LXQu9C1INGB0L7QvtCx0YnQtdC90LjRjyAo0J/QvtGB0YLQsNCy0YnQuNC60LUpDQoJCQkJKNCy0LDQu9C40LTQuNGA0YPQtdGC0YHRjyDQodCc0K3QkiDRgNC10YHRgtGA0YMg0L/QvtGB0YLQsNCy0YnQuNC60L7QsikNCgkJCTwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJPcmlnaW5hdG9yIiB0eXBlPSJzbWV2Om9yZ0V4dGVybmFsVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JTQsNC90L3Ri9C1INC+INGB0LjRgdGC0LXQvNC1LCDQuNC90LjRhtC40LjRgNC+0LLQsNCy0LDRiNC10Lkg0YbQtdC/0L7Rh9C60YMg0LjQtw0KCQkJCdC90LXRgdC60L7Qu9GM0LrQuNGFINC30LDQv9GA0L7RgdC+0LIt0L7RgtCy0LXRgtC+0LIsINC+0LHRitC10LTQuNC90LXQvdC90YvRhSDQtdC00LjQvdGL0Lwg0L/RgNC+0YbQtdGB0YHQvtC8INCyINGA0LDQvNC60LDRhQ0KCQkJCdCy0LfQsNC40LzQvtC00LXQudGB0YLQstC40Y8NCgkJCTwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJUeXBlQ29kZSIgdHlwZT0ic21ldjpUeXBlQ29kZVR5cGUiPg0KCQk8eHM6YW5ub3RhdGlvbj4NCgkJCTx4czpkb2N1bWVudGF0aW9uPtCi0LjQvyDRgdC+0L7QsdGJ0LXQvdC40Y88L3hzOmRvY3VtZW50YXRpb24+DQoJCTwveHM6YW5ub3RhdGlvbj4NCgk8L3hzOmVsZW1lbnQ+DQoJPHhzOmVsZW1lbnQgbmFtZT0iRGF0ZSIgdHlwZT0ieHM6ZGF0ZVRpbWUiPg0KCQk8eHM6YW5ub3RhdGlvbj4NCgkJCTx4czpkb2N1bWVudGF0aW9uPtCU0LDRgtCwINGB0L7Qt9C00LDQvdC40Y8g0LfQsNC/0YDQvtGB0LA8L3hzOmRvY3VtZW50YXRpb24+DQoJCTwveHM6YW5ub3RhdGlvbj4NCgk8L3hzOmVsZW1lbnQ+DQoJPHhzOmVsZW1lbnQgbmFtZT0iUmVxdWVzdElkUmVmIiB0eXBlPSJzbWV2OmlkVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0YHQvtC+0LHRidC10L3QuNGPLdC30LDQv9GA0L7RgdCwLCDQuNC90LjRhtC40LjRgNC+0LLQsNCy0YjQtdCz0L4NCgkJCQnQstC30LDQuNC80L7QtNC10LnRgdGC0LLQuNC1DQoJCQk8L3hzOmRvY3VtZW50YXRpb24+DQoJCTwveHM6YW5ub3RhdGlvbj4NCgk8L3hzOmVsZW1lbnQ+DQoJPHhzOmVsZW1lbnQgbmFtZT0iT3JpZ2luUmVxdWVzdElkUmVmIiB0eXBlPSJzbWV2OmlkVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0YHQvtC+0LHRidC10L3QuNGPLdC30LDQv9GA0L7RgdCwLCDQuNC90LjRhtC40LjRgNC+0LLQsNCy0YjQtdCz0L4NCgkJCQnRhtC10L/QvtGH0LrRgyDQuNC3INC90LXRgdC60L7Qu9GM0LrQuNGFINC30LDQv9GA0L7RgdC+0LIt0L7RgtCy0LXRgtC+0LIsINC+0LHRitC10LTQuNC90LXQvdC90YvRhSDQtdC00LjQvdGL0LwNCgkJCQnQv9GA0L7RhtC10YHRgdC+0Lwg0LIg0YDQsNC80LrQsNGFINCy0LfQsNC40LzQvtC00LXQudGB0YLQstC40Y8NCgkJCTwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJTZXJ2aWNlQ29kZSIgdHlwZT0ieHM6c3RyaW5nIj4NCgkJPHhzOmFubm90YXRpb24+DQoJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QmtC+0LQg0YPRgdC70YPQs9C4PC94czpkb2N1bWVudGF0aW9uPg0KCQk8L3hzOmFubm90YXRpb24+DQoJPC94czplbGVtZW50Pg0KCTx4czplbGVtZW50IG5hbWU9IkNhc2VOdW1iZXIiIHR5cGU9InhzOnN0cmluZyI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0J3QvtC80LXRgCDQt9Cw0Y/QstC60Lgg0LIg0LjQvdGE0L7RgNC80LDRhtC40L7QvdC90L7QuSDRgdC40YHRgtC10LzQtS3QvtGC0L/RgNCw0LLQuNGC0LXQu9C1DQoJCQk8L3hzOmRvY3VtZW50YXRpb24+DQoJCTwveHM6YW5ub3RhdGlvbj4NCgk8L3hzOmVsZW1lbnQ+DQoJPHhzOmVsZW1lbnQgbmFtZT0iTWVzc2FnZUlkIiB0eXBlPSJzbWV2OmlkVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0YHQvtC+0LHRidC10L3QuNGPPC94czpkb2N1bWVudGF0aW9uPg0KCQk8L3hzOmFubm90YXRpb24+DQoJPC94czplbGVtZW50Pg0KCTx4czplbGVtZW50IG5hbWU9IlRpbWVTdGFtcCIgdHlwZT0ieHM6ZGF0ZVRpbWUiPg0KCQk8eHM6YW5ub3RhdGlvbj4NCgkJCTx4czpkb2N1bWVudGF0aW9uPtCc0LXRgtC60LAg0LLRgNC10LzQtdC90Lgg0L/QvtC70YPRh9C10L3QuNGPINC30LDQv9GA0L7RgdCwINCh0JzQrdCS0L7QvA0KCQkJPC94czpkb2N1bWVudGF0aW9uPg0KCQk8L3hzOmFubm90YXRpb24+DQoJPC94czplbGVtZW50Pg0KCTx4czplbGVtZW50IG5hbWU9Ik5vZGVJZCIgdHlwZT0ieHM6c3RyaW5nIj4NCgkJPHhzOmFubm90YXRpb24+DQoJCQk8eHM6ZG9jdW1lbnRhdGlvbj7Qo9C90LjQutCw0LvRjNC90YvQuSDQuNC00LXQvdGC0LjRhNC40LrQsNGC0L7RgCDRg9C30LvQsDwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJNZXNzYWdlQ2xhc3MiIHR5cGU9InNtZXY6TWVzc2FnZUNsYXNzVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0LrQu9Cw0YHRgdCwINGB0L7QvtCx0YnQtdC90LjRjzwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJTdGF0dXMiIHR5cGU9InNtZXY6U3RhdHVzVHlwZSI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0KHRgtCw0YLRg9GBINGB0L7QvtCx0YnQtdC90LjRjzwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJFeGNoYW5nZVR5cGUiIHR5cGU9InhzOnN0cmluZyI+DQoJCTx4czphbm5vdGF0aW9uPg0KCQkJPHhzOmRvY3VtZW50YXRpb24+0JrQsNGC0LXQs9C+0YDQuNGPINCy0LfQsNC40LzQvtC00LXQudGB0YLQstC40Y88L3hzOmRvY3VtZW50YXRpb24+DQoJCTwveHM6YW5ub3RhdGlvbj4NCgk8L3hzOmVsZW1lbnQ+DQoJPHhzOmVsZW1lbnQgbmFtZT0iQmluYXJ5RGF0YSIgdHlwZT0ieHM6YmFzZTY0QmluYXJ5Ij4NCgkJPHhzOmFubm90YXRpb24+DQoJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QmtC+0L3RgtC10L3RgiDQstC70L7QttC10L3QuNGPPC94czpkb2N1bWVudGF0aW9uPg0KCQk8L3hzOmFubm90YXRpb24+DQoJPC94czplbGVtZW50Pg0KCTx4czplbGVtZW50IG5hbWU9IlJlZmVyZW5jZSIgdHlwZT0ic21ldjpSZWZlcmVuY2VUeXBlIj4NCgkJPHhzOmFubm90YXRpb24+DQoJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QodGB0YvQu9C60LAg0L3QsCDQstC70L7QttC10L3QuNC1PC94czpkb2N1bWVudGF0aW9uPg0KCQk8L3hzOmFubm90YXRpb24+DQoJPC94czplbGVtZW50Pg0KCTx4czplbGVtZW50IG5hbWU9IkRpZ2VzdFZhbHVlIiB0eXBlPSJ4czpiYXNlNjRCaW5hcnkiPg0KCQk8eHM6YW5ub3RhdGlvbj4NCgkJCTx4czpkb2N1bWVudGF0aW9uPtCl0LXRiC3QutC+0LQg0LLQu9C+0LbQtdC90LjRjzwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJUZXN0TXNnIiB0eXBlPSJ4czpzdHJpbmciPg0KCQk8eHM6YW5ub3RhdGlvbj4NCgkJCTx4czpkb2N1bWVudGF0aW9uPtCY0LTQtdC90YLQuNGE0LjQutCw0YLQvtGAINGC0LXRgdGC0L7QstC+0LPQviDQt9Cw0L/RgNC+0YHQsDwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJPC94czphbm5vdGF0aW9uPg0KCTwveHM6ZWxlbWVudD4NCgk8eHM6ZWxlbWVudCBuYW1lPSJSZXF1ZXN0Q29kZSIgdHlwZT0ieHM6c3RyaW5nIj4NCgkJPHhzOmFubm90YXRpb24+DQoJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QmtC+0LQg0LfQsNGP0LLQu9C10L3QuNGPPC94czpkb2N1bWVudGF0aW9uPg0KCQk8L3hzOmFubm90YXRpb24+DQoJPC94czplbGVtZW50Pg0KDQoJPHhzOmNvbXBsZXhUeXBlIG5hbWU9Ik1lc3NhZ2VUeXBlIj4NCgkJPHhzOnNlcXVlbmNlPg0KCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2OlNlbmRlciIvPg0KCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2OlJlY2lwaWVudCIvPg0KCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2Ok9yaWdpbmF0b3IiIG1pbk9jY3Vycz0iMCIvPg0KCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2OlR5cGVDb2RlIi8+DQoJCQk8eHM6ZWxlbWVudCByZWY9InNtZXY6U3RhdHVzIi8+DQoJCQk8eHM6ZWxlbWVudCByZWY9InNtZXY6RGF0ZSIvPg0KCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2OkV4Y2hhbmdlVHlwZSIvPg0KCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2OlJlcXVlc3RJZFJlZiIgbWluT2NjdXJzPSIwIi8+DQoJCQk8eHM6ZWxlbWVudCByZWY9InNtZXY6T3JpZ2luUmVxdWVzdElkUmVmIiBtaW5PY2N1cnM9IjAiLz4NCgkJCTx4czplbGVtZW50IHJlZj0ic21ldjpTZXJ2aWNlQ29kZSIgbWluT2NjdXJzPSIwIi8+DQoJCQk8eHM6ZWxlbWVudCByZWY9InNtZXY6Q2FzZU51bWJlciIgbWluT2NjdXJzPSIwIi8+DQoJCQk8eHM6ZWxlbWVudCByZWY9InNtZXY6VGVzdE1zZyIgbWluT2NjdXJzPSIwIi8+DQoJCTwveHM6c2VxdWVuY2U+DQoJPC94czpjb21wbGV4VHlwZT4NCgkNCg0KCTx4czpjb21wbGV4VHlwZSBuYW1lPSJBcHBEb2N1bWVudFR5cGUiPg0KCQk8eHM6c2VxdWVuY2U+DQoJCQk8eHM6ZWxlbWVudCByZWY9InNtZXY6UmVxdWVzdENvZGUiIC8+DQoJCQk8eHM6Y2hvaWNlPg0KCQkJCTx4czplbGVtZW50IHJlZj0ic21ldjpCaW5hcnlEYXRhIiAvPg0KCQkJCTx4czpzZXF1ZW5jZT4NCgkJCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2OlJlZmVyZW5jZSIgLz4NCgkJCQkJPHhzOmVsZW1lbnQgcmVmPSJzbWV2OkRpZ2VzdFZhbHVlIiAvPg0KCQkJCTwveHM6c2VxdWVuY2U+DQoJCQk8L3hzOmNob2ljZT4NCgkJPC94czpzZXF1ZW5jZT4NCgk8L3hzOmNvbXBsZXhUeXBlPg0KCTx4czpjb21wbGV4VHlwZSBuYW1lPSJSZWZlcmVuY2VUeXBlIiBtaXhlZD0idHJ1ZSI+DQoJCTx4czpzZXF1ZW5jZT4NCgkJCTx4czplbGVtZW50IHJlZj0ieG9wOkluY2x1ZGUiIG1pbk9jY3Vycz0iMCIgLz4NCgkJPC94czpzZXF1ZW5jZT4NCgk8L3hzOmNvbXBsZXhUeXBlPg0KCQ0KCTx4czpjb21wbGV4VHlwZSBuYW1lPSJvcmdFeHRlcm5hbFR5cGUiPg0KCQk8eHM6YW5ub3RhdGlvbj4NCgkJCTx4czpkb2N1bWVudGF0aW9uPtCh0LLQtdC00LXQvdC40Y8g0L7QsSDQuNC90YTQvtGA0LzQsNGG0LjQvtC90L3QvtC5INGB0LjRgdGC0LXQvNC1DQoJCQk8L3hzOmRvY3VtZW50YXRpb24+DQoJCTwveHM6YW5ub3RhdGlvbj4NCgkJPHhzOnNlcXVlbmNlPg0KCQkJPHhzOmVsZW1lbnQgbmFtZT0iQ29kZSIgdHlwZT0ieHM6c3RyaW5nIj4NCgkJCQk8eHM6YW5ub3RhdGlvbj4NCgkJCQkJPHhzOmRvY3VtZW50YXRpb24+0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0YHQuNGB0YLQtdC80Ys8L3hzOmRvY3VtZW50YXRpb24+DQoJCQkJPC94czphbm5vdGF0aW9uPg0KCQkJPC94czplbGVtZW50Pg0KCQkJPHhzOmVsZW1lbnQgbmFtZT0iTmFtZSIgdHlwZT0ieHM6c3RyaW5nIj4NCgkJCQk8eHM6YW5ub3RhdGlvbj4NCgkJCQkJPHhzOmRvY3VtZW50YXRpb24+0J3QsNC40LzQtdC90L7QstCw0L3QuNC1INGB0LjRgdGC0LXQvNGLPC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZWxlbWVudD4NCgkJPC94czpzZXF1ZW5jZT4NCgk8L3hzOmNvbXBsZXhUeXBlPg0KCTx4czpzaW1wbGVUeXBlIG5hbWU9IlR5cGVDb2RlVHlwZSI+DQoJCTx4czpyZXN0cmljdGlvbiBiYXNlPSJ4czpzdHJpbmciPg0KCQkJPHhzOmVudW1lcmF0aW9uIHZhbHVlPSJHU1JWIj4NCgkJCQk8eHM6YW5ub3RhdGlvbj4NCgkJCQkJPHhzOmRvY3VtZW50YXRpb24+0JLQt9Cw0LjQvNC+0LTQtdC50YHRgtCy0LjQtSDQsiDRgNCw0LzQutCw0YUg0L7QutCw0LfQsNC90LjRjyDQs9C+0YHRg9C00LDRgNGB0YLQstC10L3QvdGL0YUNCgkJCQkJCdGD0YHQu9GD0LMNCgkJCQkJPC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCQk8eHM6ZW51bWVyYXRpb24gdmFsdWU9IkdGTkMiPg0KCQkJCTx4czphbm5vdGF0aW9uPg0KCQkJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QktC30LDQuNC80L7QtNC10LnRgdGC0LLQuNC1INCyINGA0LDQvNC60LDRhSDQuNGB0L/QvtC70L3QtdC90LjRjw0KCQkJCQk8L3hzOmRvY3VtZW50YXRpb24+DQoJCQkJPC94czphbm5vdGF0aW9uPg0KCQkJPC94czplbnVtZXJhdGlvbj4NCgkJPC94czpyZXN0cmljdGlvbj4NCgk8L3hzOnNpbXBsZVR5cGU+DQoJPHhzOnNpbXBsZVR5cGUgbmFtZT0iTWVzc2FnZUNsYXNzVHlwZSI+DQoJCTx4czpyZXN0cmljdGlvbiBiYXNlPSJ4czpzdHJpbmciPg0KCQkJPHhzOmVudW1lcmF0aW9uIHZhbHVlPSJSRVFVRVNUIj4NCgkJCQk8eHM6YW5ub3RhdGlvbj4NCgkJCQkJPHhzOmRvY3VtZW50YXRpb24+0JfQsNC/0YDQvtGBINC+0YIg0L/QvtGC0YDQtdCx0LjRgtC10LvRjyDQuiDQv9C+0YHRgtCw0LLRidC40LrRgw0KCQkJCQk8L3hzOmRvY3VtZW50YXRpb24+DQoJCQkJPC94czphbm5vdGF0aW9uPg0KCQkJPC94czplbnVtZXJhdGlvbj4NCgkJCTx4czplbnVtZXJhdGlvbiB2YWx1ZT0iUkVTUE9OU0UiPg0KCQkJCTx4czphbm5vdGF0aW9uPg0KCQkJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QntGC0LLQtdGCINC/0L7RgdGC0LDQstGJ0LjQutCwINC/0L7RgtGA0LXQsdC40YLQtdC70Y48L3hzOmRvY3VtZW50YXRpb24+DQoJCQkJPC94czphbm5vdGF0aW9uPg0KCQkJPC94czplbnVtZXJhdGlvbj4NCgkJPC94czpyZXN0cmljdGlvbj4NCgk8L3hzOnNpbXBsZVR5cGU+DQoJPHhzOnNpbXBsZVR5cGUgbmFtZT0iU3RhdHVzVHlwZSI+DQoJCTx4czpyZXN0cmljdGlvbiBiYXNlPSJ4czpzdHJpbmciPg0KCQkJPHhzOmVudW1lcmF0aW9uIHZhbHVlPSJSRVFVRVNUIj4NCgkJCQk8eHM6YW5ub3RhdGlvbj4NCgkJCQkJPHhzOmRvY3VtZW50YXRpb24+0JfQsNC/0YDQvtGBPC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCQk8eHM6ZW51bWVyYXRpb24gdmFsdWU9IlJFU1VMVCI+DQoJCQkJPHhzOmFubm90YXRpb24+DQoJCQkJCTx4czpkb2N1bWVudGF0aW9uPtCg0LXQt9GD0LvRjNGC0LDRgjwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJCQk8L3hzOmFubm90YXRpb24+DQoJCQk8L3hzOmVudW1lcmF0aW9uPg0KCQkJPHhzOmVudW1lcmF0aW9uIHZhbHVlPSJSRUpFQ1QiPg0KCQkJCTx4czphbm5vdGF0aW9uPg0KCQkJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QnNC+0YLQuNCy0LjRgNC+0LLQsNC90L3Ri9C5INC+0YLQutCw0Lc8L3hzOmRvY3VtZW50YXRpb24+DQoJCQkJPC94czphbm5vdGF0aW9uPg0KCQkJPC94czplbnVtZXJhdGlvbj4NCgkJCTx4czplbnVtZXJhdGlvbiB2YWx1ZT0iSU5WQUxJRCI+DQoJCQkJPHhzOmFubm90YXRpb24+DQoJCQkJCTx4czpkb2N1bWVudGF0aW9uPtCe0YjQuNCx0LrQsCDQv9GA0Lgg0KTQm9CaPC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCQk8eHM6ZW51bWVyYXRpb24gdmFsdWU9IkFDQ0VQVCI+DQoJCQkJPHhzOmFubm90YXRpb24+DQoJCQkJCTx4czpkb2N1bWVudGF0aW9uPtCh0L7QvtCx0YnQtdC90LjQtS3QutCy0LjRgtC+0Log0L4g0L/RgNC40LXQvNC1PC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCQk8eHM6ZW51bWVyYXRpb24gdmFsdWU9IlBJTkciPg0KCQkJCTx4czphbm5vdGF0aW9uPg0KCQkJCQk8eHM6ZG9jdW1lbnRhdGlvbj7Ql9Cw0L/RgNC+0YEg0LTQsNC90L3Ri9GFL9GA0LXQt9GD0LvRjNGC0LDRgtC+0LI8L3hzOmRvY3VtZW50YXRpb24+DQoJCQkJPC94czphbm5vdGF0aW9uPg0KCQkJPC94czplbnVtZXJhdGlvbj4NCgkJCTx4czplbnVtZXJhdGlvbiB2YWx1ZT0iUFJPQ0VTUyI+DQoJCQkJPHhzOmFubm90YXRpb24+DQoJCQkJCTx4czpkb2N1bWVudGF0aW9uPtCSINC+0LHRgNCw0LHQvtGC0LrQtTwveHM6ZG9jdW1lbnRhdGlvbj4NCgkJCQk8L3hzOmFubm90YXRpb24+DQoJCQk8L3hzOmVudW1lcmF0aW9uPg0KCQkJPHhzOmVudW1lcmF0aW9uIHZhbHVlPSJOT1RJRlkiPg0KCQkJCTx4czphbm5vdGF0aW9uPg0KCQkJCQk8eHM6ZG9jdW1lbnRhdGlvbj7Qo9Cy0LXQtNC+0LzQu9C10L3QuNC1INC+0LEg0L7RiNC40LHQutC1PC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCQk8eHM6ZW51bWVyYXRpb24gdmFsdWU9IkZBSUxVUkUiPg0KCQkJCTx4czphbm5vdGF0aW9uPg0KCQkJCQk8eHM6ZG9jdW1lbnRhdGlvbj7QotC10YXQvdC40YfQtdGB0LrQuNC5INGB0LHQvtC5PC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCQk8eHM6ZW51bWVyYXRpb24gdmFsdWU9IkNBTkNFTCI+DQoJCQkJPHhzOmFubm90YXRpb24+DQoJCQkJCTx4czpkb2N1bWVudGF0aW9uPtCe0YLQt9GL0LIg0LfQsNGP0LLQu9C10L3QuNGPPC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCQk8eHM6ZW51bWVyYXRpb24gdmFsdWU9IlNUQVRFIj4NCgkJCQk8eHM6YW5ub3RhdGlvbj4NCgkJCQkJPHhzOmRvY3VtZW50YXRpb24+0JLQvtC30LLRgNCw0YIg0YHQvtGB0YLQvtGP0L3QuNGPPC94czpkb2N1bWVudGF0aW9uPg0KCQkJCTwveHM6YW5ub3RhdGlvbj4NCgkJCTwveHM6ZW51bWVyYXRpb24+DQoJCTwveHM6cmVzdHJpY3Rpb24+DQoJPC94czpzaW1wbGVUeXBlPg0KCTx4czpzaW1wbGVUeXBlIG5hbWU9ImlkVHlwZSI+DQoJCTx4czpyZXN0cmljdGlvbiBiYXNlPSJ4czpzdHJpbmciLz4NCgk8L3hzOnNpbXBsZVR5cGU+DQoJDQoJPHhzOmNvbXBsZXhUeXBlIG5hbWU9IkFwcERhdGFUeXBlIj4NCgkJPHhzOnNlcXVlbmNlLz4NCgkJPHhzOmFueUF0dHJpYnV0ZSBwcm9jZXNzQ29udGVudHM9ImxheCIvPg0KCTwveHM6Y29tcGxleFR5cGU+DQoNCgk8eHM6Y29tcGxleFR5cGUgbmFtZT0iTWVzc2FnZURhdGFUeXBlIj4NCgkJPHhzOnNlcXVlbmNlLz4NCgk8L3hzOmNvbXBsZXhUeXBlPg0KCQ0KCTx4czpjb21wbGV4VHlwZSBuYW1lPSJCYXNlVHlwZSI+DQoJCTx4czpzZXF1ZW5jZT4NCgkJCTx4czplbGVtZW50IG5hbWU9Ik1lc3NhZ2UiIHR5cGU9InNtZXY6TWVzc2FnZVR5cGUiLz4NCgkJPC94czpzZXF1ZW5jZT4NCgk8L3hzOmNvbXBsZXhUeXBlPgkNCgkNCjwveHM6c2NoZW1hPg0K";
		Object result = ApplicationHelper.extractApplication(
				encoded.getBytes(), unmarshaller);
		Assert.assertNotNull(result);
	}

	@Test
	// @Ignore
	public void signFile() throws Exception {
		String srcFileName = "testspace/req_001012314.xml";
		//InputStream is = this.getClass().getClassLoader().getResourceAsStream(srcFileName);
        InputStream is = new FileInputStream(new File(srcFileName));
		ByteArrayOutputStream baos = new ByteArrayOutputStream();
		byte[] buffer = new byte[2048];
		int count = -1;
		while ((count = is.read(buffer)) != -1) {
			baos.write(buffer, 0, count);
		}
		;
		byte[] result = baos.toByteArray();
		SecurityServiceImpl ssi = new SecurityServiceImpl();
        ssi.setKeyStorePath("HDImageStore");
        ssi.setAliasName("test_key");
		ssi.setPassword("test");
		List<byte[]> signature = ssi.signByteArray(result);
        byte[] digest = ru.CryptoPro.JCP.Digest.GostDigest.digestData(result);
		ru.CryptoPro.JCP.tools.Array.writeFile(srcFileName + ".hash", Base64.encodeBase64(signature.get(0)));
		ru.CryptoPro.JCP.tools.Array.writeFile(srcFileName + ".sig", signature.get(1));
        ru.CryptoPro.JCP.tools.Array.writeFile(srcFileName + ".digest", Base64.encodeBase64(digest));
//		ru.CryptoPro.JCP.tools.Array.writeFile("attachment.doc.hash", Base64.encodeBase64(signature.get(0)));
//		ru.CryptoPro.JCP.tools.Array.writeFile("attachment.doc.sig", signature.get(1));

		boolean b = ssi.verify(result, signature.get(1));
		Assert.assertTrue(b);
	}


	@Test
	public void verifySignFile() throws Exception {
		InputStream is = this.getClass().getClassLoader().getResourceAsStream("test/attachment.doc");
		ByteArrayOutputStream baos = new ByteArrayOutputStream();
		byte[] buffer = new byte[2048];
		int count = -1;
		while ((count = is.read(buffer)) != -1) {
			baos.write(buffer, 0, count);
		}
		;
		InputStream iss = this.getClass().getClassLoader().getResourceAsStream("test/attachment.doc.sig");
		ByteArrayOutputStream baoss = new ByteArrayOutputStream();
		count = -1;
		while ((count = iss.read(buffer)) != -1) {
			baoss.write(buffer, 0, count);
		}
		;
		byte[] result = baos.toByteArray();
		SecurityServiceImpl ssi = new SecurityServiceImpl();
        ssi.setKeyStorePath("HDImageStore");
        ssi.setAliasName("test_key");
		ssi.setPassword("test");
//		ru.CryptoPro.JCP.tools.Array.writeFile("attachment.doc.hash", Base64.encodeBase64(signature.get(0)));
//		ru.CryptoPro.JCP.tools.Array.writeFile("attachment.doc.sig", signature.get(1));

		boolean b = ssi.verify(result, baoss.toByteArray());
		Assert.assertTrue(b);
	}


	@Test
//	 @Ignore
	public void encodeFile() throws Exception {
		InputStream is = this.getClass().getClassLoader()
				.getResourceAsStream("test/req_1.zip");
		ByteArrayOutputStream baos = new ByteArrayOutputStream();
		byte[] buffer = new byte[2048];
		int count = -1;
		while ((count = is.read(buffer)) != -1) {
			baos.write(buffer, 0, count);
		}
		;
		byte[] result = Base64.encodeBase64(baos.toByteArray());
		Assert.assertNotNull(result);
		String s = new String(result);
		File f = new File("testspace/encoded.txt");
		FileOutputStream fos = new FileOutputStream(f);
		fos.write(s.getBytes());
		fos.close();
		byte[] r = Base64.decodeBase64(result);
		ZipInputStream zip = new ZipInputStream(new ByteArrayInputStream(r));
		ZipEntry ze = null;
		while ((ze = zip.getNextEntry()) != null) {
			System.out.println(ze.getName());
		}
		;
		System.out.print(zip.available());
	}

}
